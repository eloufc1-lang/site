<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Controle de Faltas</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f2f2f2;
  padding: 20px;
}

.container {
  max-width: 500px;
  margin: auto;
  background: white;
  padding: 20px;
  border-radius: 8px;
}

input, button {
  width: 100%;
  padding: 10px;
  margin-top: 8px;
}

button {
  background: #0066cc;
  color: white;
  border: none;
  cursor: pointer;
}

button:hover {
  background: #004999;
}

.alerta {
  margin-top: 10px;
  color: red;
  font-weight: bold;
}

.hidden {
  display: none;
}
</style>
</head>

<body>

<div class="container">

  <!-- LOGIN -->
  <div id="loginBox">
    <h2>Login</h2>

    <input type="text" id="usuario" placeholder="UsuÃ¡rio">
    <input type="password" id="senha" placeholder="Senha">

    <button onclick="login()">Entrar</button>

    <p id="msg" class="alerta"></p>
  </div>

  <!-- SISTEMA -->
  <div id="sistema" class="hidden">
    <h2>Registrar Falta</h2>

    <input type="text" id="professor" placeholder="Nome do Professor">
    <input type="text" id="disciplina" placeholder="Disciplina">
    <input type="date" id="data">
    <input type="text" id="motivo" placeholder="Motivo da Falta">

    <button onclick="registrarFalta()">Registrar</button>

    <p id="msgSistema" class="alerta"></p>

    <button onclick="logout()" style="margin-top:20px;background:#999;">Sair</button>
  </div>

</div>

<script>
// ðŸ”— URL DO WEB APP (Apps Script)
const API_URL = "https://script.google.com/macros/s/AKfycbxr6OZ6IiufWCZNfv49p6pLpeyw_NhCapUVRxxKZGLBeMRz9dBGiB_YTPyYdy1fSQ0JMw/exec";

// ðŸ” LISTA DE USUÃRIOS
let usuarios = [];

// ðŸ“¥ CARREGAR USUÃRIOS AO ABRIR
fetch(API_URL + "?acao=usuarios")
  .then(res => res.json())
  .then(dados => usuarios = dados)
  .catch(() => {
    document.getElementById("msg").innerText =
      "Erro ao carregar usuÃ¡rios";
  });

// ðŸ”‘ LOGIN
function login() {
  const u = document.getElementById("usuario").value;
  const s = document.getElementById("senha").value;

  const encontrado = usuarios.find(
    x => x.usuario === u && x.senha === s
  );

  if (!encontrado) {
    document.getElementById("msg").innerText =
      "UsuÃ¡rio ou senha invÃ¡lidos";
    return;
  }

  // LOGIN OK
  document.getElementById("loginBox").classList.add("hidden");
  document.getElementById("sistema").classList.remove("hidden");
}

// ðŸšª LOGOUT
function logout() {
  document.getElementById("loginBox").classList.remove("hidden");
  document.getElementById("sistema").classList.add("hidden");

  document.getElementById("msg").innerText = "";
  document.getElementById("msgSistema").innerText = "";
}

// ðŸ“ REGISTRAR FALTA
function registrarFalta() {
  const dados = {
    professor: document.getElementById("professor").value,
    disciplina: document.getElementById("disciplina").value,
    data: document.getElementById("data").value,
    motivo: document.getElementById("motivo").value
  };

  fetch(API_URL, {
    method: "POST",
    body: JSON.stringify(dados)
  })
  .then(() => {
    document.getElementById("msgSistema").innerText =
      "Falta registrada com sucesso!";
  })
  .catch(() => {
    document.getElementById("msgSistema").innerText =
      "Erro ao registrar falta";
  });
}
</script>

</body>
</html>
